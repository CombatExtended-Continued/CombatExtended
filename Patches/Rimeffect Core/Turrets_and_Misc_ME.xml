<?xml version="1.0" encoding="utf-8" ?>
<Patch>
	<Operation Class="PatchOperationFindMod">
		<mods>
		<li>Rim-Effect: Core beta 4</li>
		</mods>
		
		<match Class="PatchOperationSequence">
			<success></success>
			<operations>

		<!-- Remove refuelable property -->
		<li Class="PatchOperationRemove">
		<xpath>Defs/ThingDef[
			defName = "RE_Turret_MassAccelerator" or 		
			defName = "RE_Turret_HeavyMassAccelerator"]/comps/li[@Class = "CompProperties_Refuelable"]</xpath>
		</li>

		<!-- Replace vanilla thingClass -->
		<li Class="PatchOperationReplace">
        		<xpath>Defs/ThingDef[
			defName = "RE_Turret_MassAccelerator" or 
			defName = "RE_Turret_HeavyMassAccelerator"]/thingClass</xpath>
        		<value>
          		<thingClass>CombatExtended.Building_TurretGunCE</thingClass>
        		</value>
		</li>

		<!-- Make turrets taller -->
      <li Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName = "RE_Turret_MassAccelerator"]/fillPercent</xpath>
        <value>
          <fillPercent>0.85</fillPercent>
        </value>
      </li>

      <li Class="PatchOperationAdd">
        <xpath>Defs/ThingDef[defName = "RE_Turret_HeavyMassAccelerator"]</xpath>
        <value>
          <fillPercent>0.85</fillPercent>
        </value>
      </li>

	  <li Class="PatchOperationAdd">
	  	<xpath>Defs/ThingDef[
			defName = "RE_Turret_MassAccelerator" or 
			defName = "RE_Turret_HeavyMassAccelerator"		  
		]/statBases</xpath>
	  	<value>
	  		<AimingAccuracy>0.25</AimingAccuracy>
	  	</value>
	  </li>
  
	  <li Class="PatchOperationReplace">
	  	<xpath>Defs/ThingDef[
			defName = "RE_Turret_MassAccelerator" or 
			defName = "RE_Turret_HeavyMassAccelerator"		  
		]/statBases/ShootingAccuracyTurret</xpath>
	  	<value>
	  		<ShootingAccuracyTurret>0.5</ShootingAccuracyTurret>
	  	</value>
	  </li>

    <li Class="PatchOperationReplace">
      <xpath>Defs/ThingDef[
			defName = "RE_Turret_MassAccelerator" or 
			defName = "RE_Turret_HeavyMassAccelerator"		 
      ]/building/turretBurstCooldownTime</xpath>
      <value>
        <turretBurstCooldownTime>1.1</turretBurstCooldownTime>
      </value>
    </li>

    <li Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName = "RE_Turret_MassAccelerator"]/comps/li[@Class="CompProperties_Power"]</xpath>
		<value>
			<li Class="CompProperties_Power">
				<compClass>CompPowerTrader</compClass>
				<basePowerConsumption>200</basePowerConsumption>
			</li>	
		</value>
    </li>

    <li Class="PatchOperationReplace">
		<xpath>Defs/ThingDef[defName = "RE_Turret_HeavyMassAccelerator"]/comps/li[@Class="CompProperties_Power"]</xpath>
		<value>
			<li Class="CompProperties_Power">
				<compClass>CompPowerTrader</compClass>
				<basePowerConsumption>800</basePowerConsumption>
			</li>	
		</value>
    </li>
			<!-- Make the Turret usable -->

			<li Class="CombatExtended.PatchOperationMakeGunCECompatible">
			<defName>RE_Gun_MassAccelerator</defName>
			  <statBases>
			  <Mass>10.00</Mass>
			  <RangedWeapon_Cooldown>0.4</RangedWeapon_Cooldown>
			  <SightsEfficiency>1</SightsEfficiency>
			  <ShotSpread>0.08</ShotSpread>
			  <SwayFactor>1.33</SwayFactor>
			  <Bulk>1.00</Bulk>
			</statBases>
			<Properties>
			  <recoilAmount>1.27</recoilAmount>
			  <verbClass>CombatExtended.Verb_ShootCE</verbClass>
			  <hasStandardCommand>true</hasStandardCommand>
			  <defaultProjectile>Bullet_M8_Basic</defaultProjectile>
			  <warmupTime>1.3</warmupTime>
			  <range>50</range>
        			<ticksBetweenBurstShots>5</ticksBetweenBurstShots>
        			<burstShotCount>10</burstShotCount>
			  <minRange>1.5</minRange>
			  <soundCast>RE_Shot_Turret</soundCast>
      			<soundCastTail>GunTail_Medium</soundCastTail>
			  <muzzleFlashScale>9</muzzleFlashScale>
			<recoilPattern>Mounted</recoilPattern>
			</Properties>
			<AmmoUser>
			  <magazineSize>50</magazineSize>
			  <reloadTime>4</reloadTime>
			  <ammoSet>AmmoSet_M8</ammoSet>
			</AmmoUser>
			<FireModes>
			  <aiAimMode>AimedShot</aiAimMode>
      			<aimedBurstShotCount>5</aimedBurstShotCount>
      			<noSnapshot>true</noSnapshot>
      			<noSingleShot>true</noSingleShot>
			</FireModes>
			</li>

			<!-- Make the Cannon usable -->

			<li Class="CombatExtended.PatchOperationMakeGunCECompatible">
			<defName>RE_Turret_HeavyMassAccelerator</defName>
			  <statBases>
			  <Mass>50.00</Mass>
			  <RangedWeapon_Cooldown>1</RangedWeapon_Cooldown>
			  <SightsEfficiency>1.1</SightsEfficiency>
			  <ShotSpread>0.03</ShotSpread>
			  <SwayFactor>1.56</SwayFactor>
			  <Bulk>1.00</Bulk>
			</statBases>
			<Properties>
			  <verbClass>CombatExtended.Verb_ShootCE</verbClass>
			  <hasStandardCommand>true</hasStandardCommand>
			  <defaultProjectile>VFE_Bullet_Cannon</defaultProjectile>
			  <recoilAmount>1.48</recoilAmount>
			  <warmupTime>2</warmupTime>
			  <range>78</range>
			  <minRange>5.9</minRange>
                                                 <ammoConsumedPerShotCount>20</ammoConsumedPerShotCount>
        			<ticksBetweenBurstShots>30</ticksBetweenBurstShots>
        			<burstShotCount>3</burstShotCount>
			  <soundCast>RE_Shot_HeavyTurret</soundCast>
      			<soundCastTail>GunTail_Heavy</soundCastTail>
			  <muzzleFlashScale>12</muzzleFlashScale>
			<recoilPattern>Mounted</recoilPattern>
			</Properties>
			<AmmoUser>
			  <magazineSize>400</magazineSize>
			  <reloadTime>5.9</reloadTime>
			  <ammoSet>AmmoSet_Cannon</ammoSet>
			</AmmoUser>
			<FireModes>
			  <aiAimMode>AimedShot</aiAimMode>
      			  <noSnapshot>true</noSnapshot>
			</FireModes>
			</li>

			<!-- Remove ammobelts -->
<!--    			<li Class="PatchOperationRemove">
				<xpath>Defs/ThingDef[defName="RE_AmmoCryoBelt"]</xpath>
			</li>
    			<li Class="PatchOperationRemove">
				<xpath>Defs/ThingDef[defName="RE_AmmoDisruptorBelt"]</xpath>
			</li>
    			<li Class="PatchOperationRemove">
				<xpath>Defs/ThingDef[defName="RE_AmmoExplosiveBelt"]</xpath>
			</li>
    			<li Class="PatchOperationRemove">
				<xpath>Defs/ThingDef[defName="RE_AmmoIncendiaryBelt"]</xpath>
			</li>
    			<li Class="PatchOperationRemove">
				<xpath>Defs/ThingDef[defName="RE_AmmoToxicBelt"]</xpath>
			</li>
-->			

			<!-- Implant Hediffs -->
    			<li Class="PatchOperationAdd">
				<xpath>Defs/HediffDef[defName="RE_AdrenalineModule"]/stages/li[1]</xpath>
				<value>
				<statOffsets>
					<Suppressability>-0.2</Suppressability>
				</statOffsets>
			</value>
			</li>

		<li Class="PatchOperationReplace">
		<xpath>Defs/HediffDef[defName="RE_OmniToolHediff"]/comps/li[@Class="HediffCompProperties_VerbGiver"]/tools</xpath>
		<value>
			<tools>
				<li Class="CombatExtended.ToolCE">
					<label>Stab</label>
					<capacities>
						<li>Stab</li>
					</capacities>
					<power>23</power>
					<cooldownTime>1.33</cooldownTime>
					<armorPenetrationSharp>32</armorPenetrationSharp>
					<armorPenetrationBlunt>1</armorPenetrationBlunt>
					<linkedBodyPartsGroup>Blade</linkedBodyPartsGroup>
				</li>
				<li Class="CombatExtended.ToolCE">
					<label>Cut</label>
					<capacities>
						<li>Cut</li>
					</capacities>
					<power>28</power>
					<cooldownTime>1.45</cooldownTime>
					<armorPenetrationSharp>16</armorPenetrationSharp>
					<armorPenetrationBlunt>2</armorPenetrationBlunt>
					<linkedBodyPartsGroup>Blade</linkedBodyPartsGroup>
				</li>
			</tools>
		</value>
	</li>

		<!-- Add items to traders -->
      <li Class="PatchOperationAdd">
		<xpath>Defs/TraderKindDef[defName="RE_Base_Alliance_Standard"]/stockGenerators</xpath>
		<value>
      <li Class="StockGenerator_SingleDef">
        <thingDef>FSX</thingDef>
        <countRange>
          <min>25</min>
          <max>75</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Prometheum</thingDef>
        <countRange>
          <min>25</min>
          <max>75</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME</thingDef>
        <countRange>
          <min>300</min>
          <max>1200</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_AP</thingDef>
        <countRange>
          <min>-300</min>
          <max>800</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_Cryo</thingDef>
        <countRange>
          <min>-300</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_HE</thingDef>
        <countRange>
          <min>-300</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_FI</thingDef>
        <countRange>
          <min>-300</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_Ion</thingDef>
        <countRange>
          <min>-300</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_Toxic</thingDef>
        <countRange>
          <min>-300</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_Tag">
        <tradeTag>CE_Turret</tradeTag>
        <thingDefCountRange>
          <min>-2</min>
          <max>3</max>
        </thingDefCountRange>
        <countRange>
          <min>1</min>
          <max>2</max>
        </countRange>
      </li>
      <li Class="StockGenerator_Category">
        <categoryDef>WeaponsTurrets</categoryDef>
        <thingDefCountRange>
          <min>0</min>
          <max>0</max>
        </thingDefCountRange>
      </li>
		</value>
	</li>

      <li Class="PatchOperationAdd">
		<xpath>Defs/TraderKindDef[defName="RE_Caravan_Alliance_CombatSupplier"]/stockGenerators</xpath>
		<value>
      <li Class="StockGenerator_SingleDef">
        <thingDef>FSX</thingDef>
        <countRange>
          <min>15</min>
          <max>35</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Prometheum</thingDef>
        <countRange>
          <min>15</min>
          <max>35</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME</thingDef>
        <countRange>
          <min>200</min>
          <max>800</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_AP</thingDef>
        <countRange>
          <min>100</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_Cryo</thingDef>
        <countRange>
          <min>-200</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_HE</thingDef>
        <countRange>
          <min>-200</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_FI</thingDef>
        <countRange>
          <min>-300</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_Ion</thingDef>
        <countRange>
          <min>-200</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_Toxic</thingDef>
        <countRange>
          <min>-200</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_Tag">
        <tradeTag>CE_Turret</tradeTag>
        <thingDefCountRange>
          <min>-2</min>
          <max>1</max>
        </thingDefCountRange>
        <countRange>
          <min>1</min>
          <max>1</max>
        </countRange>
      </li>
      <li Class="StockGenerator_Category">
        <categoryDef>WeaponsTurrets</categoryDef>
        <thingDefCountRange>
          <min>0</min>
          <max>0</max>
        </thingDefCountRange>
      </li>
		</value>
	</li>

      <li Class="PatchOperationAdd">
		<xpath>Defs/TraderKindDef[defName="RE_Caravan_Alliance_BulkGoods"]/stockGenerators</xpath>
		<value>
      <li Class="StockGenerator_SingleDef">
        <thingDef>FSX</thingDef>
        <countRange>
          <min>15</min>
          <max>45</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Prometheum</thingDef>
        <countRange>
          <min>15</min>
          <max>45</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME</thingDef>
        <countRange>
          <min>100</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_AP</thingDef>
        <countRange>
          <min>-100</min>
          <max>100</max>
        </countRange>
      </li>
		</value>
	</li>

      <li Class="PatchOperationAdd">
		<xpath>Defs/TraderKindDef[defName="RE_Caravan_Alliance_Exotic"]/stockGenerators</xpath>
		<value>
      <li Class="StockGenerator_SingleDef">
        <thingDef>FSX</thingDef>
        <countRange>
          <min>5</min>
          <max>15</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Prometheum</thingDef>
        <countRange>
          <min>5</min>
          <max>15</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME</thingDef>
        <countRange>
          <min>100</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_AP</thingDef>
        <countRange>
          <min>-100</min>
          <max>300</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_Cryo</thingDef>
        <countRange>
          <min>-150</min>
          <max>150</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_HE</thingDef>
        <countRange>
          <min>-150</min>
          <max>150</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_FI</thingDef>
        <countRange>
          <min>-150</min>
          <max>150</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_Ion</thingDef>
        <countRange>
          <min>-150</min>
          <max>150</max>
        </countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Ammo_ME_Toxic</thingDef>
        <countRange>
          <min>-150</min>
          <max>150</max>
        </countRange>
      </li>
		</value>
	</li>
			</operations>
		</match>
	</Operation>
</Patch>
