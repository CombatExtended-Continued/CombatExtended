<?xml version="1.0" encoding="utf-8" ?>

<Patch>
	<Operation Class="PatchOperationFindMod">
			<mods>
				<li>Rimsenal - Federation Faction Pack</li>
			</mods>
		<match Class="PatchOperationSequence">
		<operations>
		
			
		<!-- === Repose Plasma Grenade === -->	
		<li Class="PatchOperationAdd">
			<xpath>Defs/ThingDef[defName="Proj_Repose"]</xpath>
			<value>
				<thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
			</value>
		</li>

		<li Class="PatchOperationReplace">
			<xpath>Defs/ThingDef[defName="Proj_Repose"]/graphicData/texPath</xpath>
			<value>
				<texPath>Things/Projectile/Repose</texPath>
			</value>
		</li>

		<li Class="PatchOperationReplace">
			<xpath>Defs/ThingDef[defName="Proj_Repose"]/projectile</xpath>
			<value>
				<projectile Class="CombatExtended.ProjectilePropertiesCE">
					<explosionRadius >1</explosionRadius >
					<damageDef>Plasma</damageDef>
					<damageAmountBase>65</damageAmountBase>
					<explosionDelay>100</explosionDelay>
			<applyDamageToExplosionCellsNeighbors>true</applyDamageToExplosionCellsNeighbors>
				</projectile>
			</value>
		</li>

		<li Class="PatchOperationSequence">
		<success>Always</success>
		<operations>
			<li Class="PatchOperationTest">
			<xpath>Defs/ThingDef[defName="Proj_Repose"]/comps</xpath>
			<success>Invert</success>
			</li>
			<li Class="PatchOperationAdd">
			<xpath>Defs/ThingDef[defName="Proj_Repose"]</xpath>
			<value>
				<comps />
			</value>
			</li>
		</operations>
		</li>

		<li Class="PatchOperationAdd">
			<xpath>Defs/ThingDef[defName="Proj_Repose"]/comps</xpath>
			<value>
				<li Class="CombatExtended.CompProperties_ExplosiveCE">
				</li>
			</value>
		</li>

		<li Class="PatchOperationReplace">
			<xpath>Defs/ThingDef[defName="AD_FedPlasmaGrenades"]/label</xpath>
			<value>
				<label>plasma grenade</label>
			</value>
		</li>

		<!-- Change TickerType.-->
		<li Class="PatchOperationAdd">
			<xpath>Defs/ThingDef[defName="AD_FedPlasmaGrenades"]</xpath>
			<value>
				<tickerType>Normal</tickerType>
			</value>
		</li>	
			<li Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[defName="AD_FedPlasmaGrenades"]/graphicData</xpath>
				<value>
					<graphicData>
					  <texPath>Things/Projectile/Repose</texPath>
					  <graphicClass>Graphic_Single</graphicClass>
					  <onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
					</graphicData>
				</value>
			</li>

			<li Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[defName="AD_FedPlasmaGrenades"]</xpath>
				<value>
					<thingClass>CombatExtended.AmmoThing</thingClass>
					<stackLimit>75</stackLimit>
					<resourceReadoutPriority>First</resourceReadoutPriority>
				</value>
			</li>

			<li Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
				<li Class="PatchOperationTest">
				<xpath>Defs/ThingDef[defName="AD_FedPlasmaGrenades"]/comps</xpath>
				<success>Invert</success>
				</li>
				<li Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[defName="AD_FedPlasmaGrenades"]</xpath>
				<value>
					<comps />
				</value>
				</li>
			</operations>
			</li>

			<li Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[defName="AD_FedPlasmaGrenades"]/comps</xpath>
				<value>
					<li Class="CombatExtended.CompProperties_ExplosiveCE">
					  <damageAmountBase>40</damageAmountBase>
					  <explosiveDamageType>Plasma</explosiveDamageType>
					  <explosiveRadius>1</explosiveRadius>
					</li>
				</value>
			</li>
			
			  <li Class="CombatExtended.PatchOperationMakeGunCECompatible">
				<defName>AD_FedPlasmaGrenades</defName>
				<statBases>
					<Mass>0.45</Mass>
					<MarketValue>8.25</MarketValue>
					<RangedWeapon_Cooldown>1</RangedWeapon_Cooldown>
					<SightsEfficiency>1</SightsEfficiency>
				</statBases>
				<Properties>
					<label>throw plasma grenade</label>
					<verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
					<hasStandardCommand>true</hasStandardCommand>
					<range>12.0</range>
					<minRange>3</minRange>
					<warmupTime>0.8</warmupTime>
					<noiseRadius>4</noiseRadius>
					<ai_IsBuildingDestroyer>true</ai_IsBuildingDestroyer>
					<soundCast>ThrowGrenade</soundCast>
					<targetParams>
					  <canTargetLocations>true</canTargetLocations>
					</targetParams>
					<defaultProjectile>Proj_Repose</defaultProjectile>
					<onlyManualCast>true</onlyManualCast>
				  <ignorePartialLoSBlocker>true</ignorePartialLoSBlocker>
				</Properties>
				<weaponTags>
					<li>FedGrenade</li>			
					<li>CE_AI_Grenade</li>
					<li>CE_OneHandedWeapon</li>
				</weaponTags>
			  </li>			
			
			<!-- === Plasma Bomb Vest === -->			
			<li Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[defName="Bullet_PBomb"]</xpath>
				<value>
					  <ThingDef ParentName="BaseGrenadeProjectile">
						<defName>Bullet_PBomb</defName>
						<label>fusion device</label>
						<graphicData>
						  <texPath>Things/A16/MechPlasma</texPath>
						  <graphicClass>Graphic_Single</graphicClass>
						</graphicData>
						<projectile Class="CombatExtended.ProjectilePropertiesCE">
						  <explosionRadius>12</explosionRadius>
						  <damageDef>Plasma</damageDef>
						  <explosionDamageFalloff>true</explosionDamageFalloff>			  
						  <damageAmountBase>100</damageAmountBase>
						  <explosionDelay>0</explosionDelay>
						  <soundExplode>Explosion_GiantBomb</soundExplode>
						  <dropsCasings>false</dropsCasings>
						</projectile>
					  </ThingDef>
				</value>
			</li>

			<li Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[defName="AD_PBomb"]</xpath>
				<value>
					<equippedStatOffsets>
					  <Suppressability>-10.00</Suppressability>
					</equippedStatOffsets>				
				</value>
			</li>
				
			<li Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[defName="AD_PBomb"]</xpath>
				<value>
					  <ThingDef Class="CombatExtended.AmmoDef" ParentName="BaseGrenadeEquipment">
						<defName>AD_PBomb</defName>
						<equipmentType>Primary</equipmentType>
						<label>plasma bomb</label>
						<techLevel>Spacer</techLevel>					
						<description>A portable plasma reactor converted to suicide bombing.</description>
						<graphicData>
						  <texPath>Things/A16/PBomb</texPath>
						  <graphicClass>Graphic_Single</graphicClass>
						</graphicData>
						<soundInteract>Interact_Grenade</soundInteract>
						<statBases>
						  <MarketValue>400</MarketValue>
						  <SightsEfficiency>1</SightsEfficiency>
						  <RangedWeapon_Cooldown>0.1</RangedWeapon_Cooldown>
						</statBases>
						<weaponTags>
						   <li>FedBomb</li>
						</weaponTags>						
						<thingCategories>
						  <li>Grenades</li>
						</thingCategories>
						<verbs>
						  <li Class="CombatExtended.VerbPropertiesCE">
							<label>detonate suicide vest</label>
							<verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
							<hasStandardCommand>true</hasStandardCommand>
							<range>2</range>
							<warmupTime>0.1</warmupTime>
							<noiseRadius>4</noiseRadius>
							<ai_IsBuildingDestroyer>false</ai_IsBuildingDestroyer>
							<soundCast>ThrowGrenade</soundCast>
							<targetParams>
							  <canTargetLocations>true</canTargetLocations>
							</targetParams>
							<defaultProjectile>Bullet_PBomb</defaultProjectile>
							<onlyManualCast>true</onlyManualCast>
							<ignorePartialLoSBlocker>false</ignorePartialLoSBlocker>
						  </li>
						</verbs>
						<comps>
						  <li Class="CombatExtended.CompProperties_ExplosiveCE">
							<damageAmountBase>400</damageAmountBase>
							<explosiveDamageType>Plasma</explosiveDamageType>
							<explosiveRadius>12</explosiveRadius>
							<explosionSound>Explosion_GiantBomb</explosionSound>
						  </li>
						</comps>
					  </ThingDef>
				</value>
			</li>

		</operations>
		</match>
	</Operation>
</Patch>   